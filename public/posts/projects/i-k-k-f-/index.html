<!DOCTYPE html>
<html><head lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title> - insolubilia</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="&lt;!DOCTYPE html&gt; I-K-K-F-! Input text to begin HIGHLIGHTING 0 / 0 --:-- Go FILE Toggle option to select file or paste text - Reduce WPM &#43; Increase WPM &gt; Play/pause |&lt;&lt; Reset to start of text Arial Verdana Tahoma Times New Roman Georgia Consolas 2 Toggle 1-2-3 words shown at once V: Toggle view focus
H: Start/Stop highlighting
Space: Play/Pause
Left/right: Skip back or forward
F: Faster WPM
S: Slower WPM" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="" />
<meta property="og:description" content="&lt;!DOCTYPE html&gt; I-K-K-F-! Input text to begin HIGHLIGHTING 0 / 0 --:-- Go FILE Toggle option to select file or paste text - Reduce WPM &#43; Increase WPM &gt; Play/pause |&lt;&lt; Reset to start of text Arial Verdana Tahoma Times New Roman Georgia Consolas 2 Toggle 1-2-3 words shown at once V: Toggle view focus
H: Start/Stop highlighting
Space: Play/Pause
Left/right: Skip back or forward
F: Faster WPM
S: Slower WPM" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/projects/i-k-k-f-/" /><meta property="article:section" content="posts" />



<meta name="twitter:card" content="summary"/><meta name="twitter:title" content=""/>
<meta name="twitter:description" content="&lt;!DOCTYPE html&gt; I-K-K-F-! Input text to begin HIGHLIGHTING 0 / 0 --:-- Go FILE Toggle option to select file or paste text - Reduce WPM &#43; Increase WPM &gt; Play/pause |&lt;&lt; Reset to start of text Arial Verdana Tahoma Times New Roman Georgia Consolas 2 Toggle 1-2-3 words shown at once V: Toggle view focus
H: Start/Stop highlighting
Space: Play/Pause
Left/right: Skip back or forward
F: Faster WPM
S: Slower WPM"/>

        <link href="http://localhost:1313/css/fonts.c716c0a4f83833bdeb04c498ddd0f791514f4f90d3b8c73fc04888a13e0451a3.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.c2e65c935ff7136ec6743313818892d408f9604232741619baf32b5d5a38e2be.css" />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="http://localhost:1313/">insolubilia</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title"></h1>
          <div class="meta">Posted on Jan 1, 1</div>
        </div>
        
        <section class="body">
          <!DOCTYPE html>
<html style="--accent: #99c1f1; --lightBG: #2e3a48; --darkBG: #0f1318;"><head>
<title>I-K-K-F-!</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Geany 2.0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
		--text: #FFF;
		--lightBG: #0D3800;
		--darkBG: #071F00;
		--pageBG: #000;
		--accent: #16E937;
		--highlight: #F6D32D;
		--warning: #870000;
		--genericToggle: #a9a9a9;
		--fontSelect: "Arial";
		--outlineStyle: 1px dotted var(--accent);
		--hoverInd: brightness(1.5);
		}
		
		* {
			font-family: var(--fontSelect);
		}
		
		body {
			color: var(--text);
			background-color: var(--pageBG);
		}
		
		.main-container {
			display: flex;
			gap: 20px;
			position: relative;
			height: 95vh;
			width: 95vw;
			margin: 10px auto;		
		}
		
		.panel {
			display: flex;
			flex-direction: column;
			position: relative;
			height: 100%;
			outline: var(--outlineStyle);
			background-color: var(--darkBG);
		}
		
		.left {
			display: flex;
			width: 75%;
			
		}
		
		.right {
			display: flex;
			width: 25%;
            
		}
		
		.controlbox {
		    display: flex;
		    flex-direction: column;f
		    height: 200px;
		    padding: 10px;
	    }
		
		.text-display {
			display: flex;
			align-items: center;
			justify-content: center;
			background-color: var(--chooseBG, --pageBG);
			color: var(--chooseTC, --text);
			min-height: 70%;
			position: relative;
		}
		
		.current-word {
			font-size: 3rem;
			font-weight: bold;
			text-align: center;
		}
		
		.highlight-indicator {
			position: absolute;
			top: 10px;
			right: 10px;
			outline: var(--outlineStyle);
			color: var(--highlight);
			padding: 5px 10px;
			font-size: 12px;
			display: none;
		}
		
		.highlight-indicator.active {
			display: block;
		}			
		
		.progress-bar {
			width: 100%;
			height: 5px;
			background-color: var(--darkBG);
			overflow: hidden;
			margin-top: 10px;
		}
		
		.progress-fill {
			height: 100%;
			background-color: var(--accent);
			transition: width 0.3s;
		}			
		
		.notes-list {
		    position: relative;
			
			padding: 10px;
			height: 90%;
			overflow-y: auto;
			overflow-x: hide;
			margin-bottom: 20px;
		}
			
		.note-item1 {
			background-color: var(--lightBG);
			padding: 0;
			outline: var(--outlineStyle);
			position: relative;
		}
		
		.note-item2 {
			background-color: var(--lightBG);
			padding: 0;
			outline: var(--outlineStyle);
			position: relative;
		}
	        
		
        .note-text {
			padding: 5px;
			color: var(--text);
		}
		
        .note-time {
			font-size: 10px;
			color: var(--genericToggle);
			padding-left: 5px;
		}
		
        .note-delete {
			background-color: var(--warning);
		}
		
		.row {
			display: flex;
			align-items: flex-start;
		    align-content: center;
			width: 100%;
			gap: 10px;
			max-height: 75px;
			margin-bottom: 10px;
		}
		
		.center-align {
			align-items: center;
		}
		
		.right-align {
			margin-right: 0;
			margin-left: auto;
	        justify-content: right;
		}
		
		.left-align {
			margin-left: 0;
			margin-right: auto;
			flex: 1;
		}

		.switch-box {
			position: relative;
			width: 60px;
			height: 20px;
			outline: var(--outlineStyle);
			background-color: var(--pageBG);
		}
		
		.ontop {
		    margin: 10px 0 0 10px;
		    position: absolute;
	    }
	
		.switch-box input {
			display: none;
			width: 60px;
			height: 20px;
		}
		
		.slider {
			position: absolute;
			cursor: pointer;
			content: "";
			height: 20px;
			background-color: var(--lightBG);
			-webkit-transition: .4s;
			transition: .4s;
		}
		
		.file-or-copy {
		    position: relative;
			left: 0;
			width: 30px;
			content: "File";
		}
		
		.view-toggle {
			left: 15px;
			content: "V";
		}
		
		.word-select {
			content: "1";
		}
		
		.slider:hover {
			filter: var(--hoverInd);
		}
		
		.label {
			font-size: 10px;
			width: 30px;
			text-align: center;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		
		.file-input {
			width: 80%;
			background-color: var(--darkBG);
			height: 30px;
		}
		
		input[type=file] {
		    display: block;
			border: none;
			background-color: var(--darkBG);
			max-width: 500px;
			overflow-x: hide;
		}
		
		input[type="range"] {
			width: 150px;
			flex-shrink: 1;
			accent-color: var(--accent);
		}
		
		input[type="color"] {
			width: 50px;
			height: 30px;
			shadow: none;
			cursor: pointer;
			background-color: var(--darkBG);
			outline: var(--outlineStyle);
			border: none;
		}
		
		.text-input {
			display: flex;
			flex: 1;
			width: 80%;
			margin-bottom: 10px;
			height: 31px;
		}
		
		.paste-text {
			display: none;
			padding: 0;
			width: 80%;
			height: 31px;
			margin-bottom: 10px;
		}
		
		.no-resize {
		    resize: none;
		    }
		    
	    .edit-textarea {
	        width: 90%;
	        }
		
		textarea {
			flex: 1;
			overflow-y: scroll;
			padding: 5px;
			border: none;
			background-color: var(--pageBG);
			color: var(--text);
			outline: var(--outlineStyle);
		}

		.button {
		    display: flex;
			padding: 5px;
			border: none;
			outline: var(--outlineStyle);
			cursor: pointer;
			font-size: 10px;
			font-weight: bold;
			width: 40px;
			height: 30px;
			width: 30px;
			text-align: center;
			align-items: center;
			justify-content: center;
			background-color: var(--lightBG);
			color: var(--text);
		}
		
		.button:hover {
			filter: var(--hoverInd);
		}
		
		.wide {
		    width: 100px;
		    }

		.pasteButton {
			display: none;
		}

		.delete {
			background-color: var(--warning);
		}

		.collapsible {
		    display: flex;
			background-color: var(--lightBG);
			color: var(--text);
			padding: 5px;
			text-align: center;
			font-size: 12px;
			cursor: pointer;
			outline: var(--outlineStyle);
			border: none;
		}
		
		.active, .collapsible:hover {
			filter: brightness(1.5);
		}

		.keyboard-help {
			display: none;
			flex: 1;
			overflow: hidden;
			padding: 5px;
			background-color: var(--lightBG);
			font-size: 12px;
			outline: none;
			color:var(--text);
		}
		
		.status-bar {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px;
			background-color: var(--lightBG);
			margin-top: 10px;
			color: var(--text);
		}
		
		select {
		  display: flex;
		  padding: 0px;
		  height: 20px;
		  margin: 10px 0px;
		  background-color: var(--lightBG);
		  color: var(--text);
		  border: none;
		  outline: 1px dotted var(--accent);
		}
		option {
		  background-color: var(--lightBG);
		  border: 1px solid var(--accent);
		  color: var(--text);
		  outline: none;
		}
		option:focus {
		  filter: brightness(1.5);
		}
		
		.wpm-control {
			display: flex;
			align-items: center;
			gap: 0px;
		}
		
		.wpm-input {
			width: 60px;
			height: 28px;
			text-align: center;
			background-color: var(--darkBG);
			color: var(--text);
			outline: none;
			border: var(--outlineStyle);
			font-size: 12px;
		}
		
		.wpm-button {
			width: 20px;
			height: 20px;
			font-size: 12px;
			padding: 0;
		}
		
		.instructions {
		    color: var(--genericToggle);
		    font-size: 10px;
		    }
		
		.tooltiptext {
			visibility: hidden;
			background-color: var(--pageBG);
			border: 1px dotted var(--accent);
			color: var(--accent);
			width: 250px;
			font-size: 12px;
			height: auto;
			text-align: center;
			padding: 5px 0;
			position: absolute;
			z-index: 1;
			top: -5px;
			left: 105%;
			}
		label:hover .tooltiptext  {
			visibility: visible;
			transition-delay: 2s;
			}
		.button:hover .tooltiptext {
			visibility: visible;
			transition-delay: 2s;
			}
		input:hover .tooltiptext {
			visibility: visible;
			transition-delay: 2s;
			}
	</style>
</head>
<body>
<div class="main-container">
<div class="panel left">
	<div class="text-display" id="textDisplay" style="--chooseTC: #ffffff; --chooseBG: #000000;">
		<div class="current-word" id="currentWord">Input text to begin</div>
		<div class="highlight-indicator" id="highlightIndicator">HIGHLIGHTING</div>
	</div>
	<div class="progress-bar">
		<div class="progress-fill" id="progressFill" style="width: 0%;"></div>
	</div>
	<div class="status-bar">
		<span id="positionInfo">0 / 0</span>
		<span id="timeInfo">--:--</span>
	</div>
	<div class="controlbox">
	    <div class="row left-align">
		    <div class="file input">
			    <input type="file" id="fileInput">
		    </div>
		    <div class="paste-text">
			    <textarea placeholder="Paste text..." id="pasteText"></textarea>
		    </div>
		    <button class="button pasteButton" id="pasteTextInput" onclick="pasteText()"> Go </button>
		    <label class="switch-box right-align">
			    <input type="checkbox" onclick="inputType()">
			    <span class="label slider file-or-copy" id="inputType">FILE</span>
			    <span class="tooltiptext">Toggle option to select file or paste text</span>
		    </label>
	    </div>
	    <div class="row left-align center-align" style="flex-wrap:wrap">
			    <div class="wpm-control">
			    	<button class="button" id="wpmMinus">-
			    	
			    	<span class="tooltiptext">Reduce WPM</span>
			    	</button>
			    	<input type="text" id="wpmInput" class="wpm-input" placeholder="500">
			    	<button class="button" id="wpmPlus">+
			    	<span class="tooltiptext">Increase WPM</span>
			    	</button>
			    </div>
			    <button class="button" id="playPauseButton">&gt;
			    <span class="tooltiptext">Play/pause</span>
				    </button>
			    <button class="button" id="resetbutton">|&lt;&lt;
				    <span class="tooltiptext">Reset to start of text</span>
				    </button>
			    <input title="Text color" type="color" id="textColor" value="#ffffff">
			    <input title="Background color" type="color" id="bgColor" value="#000000">
			    <input title="Theme color" type="color" id="schemeColor" value="#99c1f1">
			    <select name="fontChoose" id="fontChoose">
			      <option style="font-family:arial" value="arial" selected="selected">Arial</option>
			      <option style="font-family:verdana" value="verdana">Verdana</option>
			      <option style="font-family:Tahoma" value="Tahoma">Tahoma</option>
			      <option style="font-family:TimesNewRoman" value="TimesNewRoman">Times New Roman</option>
			      <option style="font-family:Georgia" value="Georgia">Georgia</option>
			      <option style="font-family:Consolas" value="Consolas">Consolas</option>
			    </select>
			    <label class="switch-box">
				    <input type="checkbox" onclick="howManyWordsFunc()" checked="checked">
				    <span class="label slider word-select" id="wordCountSlider" style="transform: translateX(15px);">2</span>
				    <span class="tooltiptext">Toggle 1-2-3 words shown at once</span>
			    </label>
		            
		            <span class="instructions">
			            V: Toggle view focus<br>
			            H: Start/Stop highlighting<br>
		            </span>
		            <span class="instructions">
			            Space: Play/Pause<br>
			            Left/right: Skip back or forward<br>
			        </span>    
			        <span class="instructions">
			            F: Faster WPM<br>
			            S: Slower WPM<br>
			            Hover to get a tooltip<br>
		            </span>
	            </div>				
	</div>
</div>
<div class="panel right">
    <div class="controlbox">
    
	    <div class="row right-align">
		    <button class="button delete" id="clearNotesbutton">DEL ALL</button>
		    <button class="button" id="saveNotesbutton">SAVE .MK</button>
	    </div>
	   
	    <div class="row right-align">
		    <div class="text-input">
			    <textarea placeholder="Add custom note..." id="manualNote"></textarea>
		    </div>
		    <button class="button" id="submitManualNote" onclick="createManualNote()">⠀+⠀</button>
	    </div>
    </div>	   
        <div class="notes-list" id="notesList">
	        <div style="color: var(--genericToggle); text-align: center; padding: 20px;">
		        <br>
		        "Notes go here..."
		        <br>
        </div>
    </div>
</div>
	<label class="switch-box ontop">
	<input type="checkbox" onclick="noteFocus()">
	<span class="label slider view-toggle" id="viewSlider">V</span>
	<span class="tooltiptext">Toggle focus on reading or note panes</span>
</label>
</div>

    <script>
        let words = [];
        let currentPos = 0;
        let isPlaying = false;
        let wpm = 500;
        let notes = [];
        let isHighlighting = false;
        let highlightStart = 0;
        let playInterval = null;
        let currentFileName = '';
        let playTimeoutId = null;
        let size = 0;
        let fileToggle = 0;
        let howManyWords = 1;
        let count = 0;
        
       const elements = {
            fileInput: document.getElementById('fileInput'),
            wpmInput: document.getElementById('wpmInput'),
            wpmPlus: document.getElementById('wpmPlus'),
            wpmMinus: document.getElementById('wpmMinus'),
            speedValue: document.getElementById('speedValue'),
            playPauseButton: document.getElementById('playPauseButton'),
            resetbutton: document.getElementById('resetbutton'),
            textColor: document.getElementById('textColor'),
            bgColor: document.getElementById('bgColor'),
            schemeColor: document.getElementById('schemeColor'),
            textDisplay: document.getElementById('textDisplay'),
            currentWord: document.getElementById('currentWord'),
            highlightIndicator: document.getElementById('highlightIndicator'),
            progressFill: document.getElementById('progressFill'),
            positionInfo: document.getElementById('positionInfo'),
            timeInfo: document.getElementById('timeInfo'),
            notesList: document.getElementById('notesList'),
            saveNotesbutton: document.getElementById('saveNotesbutton'),
            clearNotesbutton: document.getElementById('clearNotesbutton'),
            fontMenu: document.getElementById('fontChoose'),
        };
        

        // File upload
        elements.fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'text/plain') {
                currentFileName = file.name.replace('.txt', ''); 
                const reader = new FileReader();
                reader.onload = function(e) {
                    loadText(e.target.result);
                };
                reader.readAsText(file);
            }
        });
        
        function inputType() {
          if (fileToggle < 1) {
            fileToggle++; }
          else fileToggle = 0;
          var pasteInput = document.querySelector('.paste-text');
          var pasteButton = document.querySelector('.pasteButton');
          var sliderBar = document.getElementById('inputType');
          
          if (fileToggle === 0) {
            fileInput.style.display="flex";
            pasteInput.style.display="none";
            pasteButton.style.display="none";
            sliderBar.style.transform = "translateX(0px)";
            sliderBar.style.webkitTransform = "translateX(0px)";
            sliderBar.style.msTransform = "translateX(0px)";
            sliderBar.textContent = 'FILE';
          }
          else {
            fileInput.style.display="none";
            pasteInput.style.display="flex";
            pasteButton.style.display="flex";
            sliderBar.style.transform = "translateX(30px)";
            sliderBar.style.webkitTransform = "translateX(30px)";
            sliderBar.style.msTransform = "translateX(30px)";
            sliderBar.textContent = 'PASTE';
          }
        }
        
        
        function pasteText() {
          var text = document.getElementById("pasteText").value;
          loadText(text);
        }
        
        // Fonts
        elements.fontMenu.addEventListener('change', function(e) {
          const root = document.documentElement;
          fontSelect = document.getElementById('fontChoose').value
          root.style.setProperty('--fontSelect', fontSelect);
        });
        
        
        // Speed control
        elements.wpmInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const newWpm = parseInt(e.target.value);
                if (!isNaN(newWpm) && newWpm >= 50 && newWpm <= 2000) {
                    wpm = newWpm;
                    elements.wpmInput.placeholder = wpm; // Update placeholder
                    if (isPlaying) {
                        currentPos--;
                        restartPlayback();
                    }
                }
                elements.wpmInput.value = '';
                elements.wpmInput.blur();
            }
        });
        
        elements.wpmPlus.addEventListener('click', function() {
            wpm = Math.min(wpm + 10, 2000);
            elements.wpmInput.placeholder = wpm; // Update placeholder
            if (isPlaying) {
                currentPos--;
                restartPlayback();
            }
        });
        
        elements.wpmMinus.addEventListener('click', function() {
            wpm = Math.max(wpm - 10, 50);
            elements.wpmInput.placeholder = wpm; // Update placeholder
            if (isPlaying) {
                currentPos--;
                restartPlayback();
            }
        });
        
        // Playback controls
        elements.playPauseButton.addEventListener('click', togglePlayPause);
        elements.resetbutton.addEventListener('click', resetReading);
        
        // Color controls
        elements.textColor.addEventListener('change', updateColors);
        elements.bgColor.addEventListener('change', updateColors);
        elements.schemeColor.addEventListener('change', updateColors);
        
        // Notes
        elements.saveNotesbutton.addEventListener('click', saveNotes);
        elements.clearNotesbutton.addEventListener('click', clearAllNotes);
        
        //Change amount of words shown
        function howManyWordsFunc() {
        var sliderBarWordCount = document.getElementById('wordCountSlider');
        if (count < 2) {
            count++; }
            else count = 0;

        if (count === 0) {
                howManyWords = 1;
                sliderBarWordCount.style.transform = "translateX(0px)";
                sliderBarWordCount.style.webkitTransform = "translateX(0px)";
                sliderBarWordCount.style.msTransform = "translateX(0px)";
                sliderBarWordCount.textContent = '1';              
        }
        else if (count === 1){
                howManyWords = 2; 
                sliderBarWordCount.style.transform = "translateX(15px)";
                sliderBarWordCount.style.webkitTransform = "translateX(15px)";
                sliderBarWordCount.style.msTransform = "translateX(15px)";    
                sliderBarWordCount.textContent = '2';          
        }
        
        else if (count === 2){
                howManyWords = 3; 
                sliderBarWordCount.style.transform = "translateX(30px)";
                sliderBarWordCount.style.webkitTransform = "translateX(30px)";
                sliderBarWordCount.style.msTransform = "translateX(30px)";
                sliderBarWordCount.textContent = '3';              
        }
        }
        
        // Expand focus on notesList
        function noteFocus() {
            //checkbox misbehaving
            if (size < 3) {
                size++; }
            else size = 0;
            var sliderBar = document.getElementById("viewSlider");
            var rightPanel = document.querySelector(".right");
            var leftPanel = document.querySelector(".left");
            var rows = document.querySelector(".controlbox");
            var collapseButton = document.querySelector(".collapsible");
            if (size === 1) {  
                rightPanel.style.display = "none";
                rows.style.display = "none";
                leftPanel.style.display = "flex";
                leftPanel.style.width = "100%";
                sliderBar.style.transform = "translateX(15px)";
                sliderBar.style.webkitTransform = "translateX(15px)";
                sliderBar.style.msTransform = "translateX(15px)";
            } 
            
            else if (size === 2) {
                leftPanel.style.display = "flex";
                rightPanel.style.display = "flex";
                rows.style.display = "flex";                
                leftPanel.style.width = "75%";
                rightPanel.style.backgroundColor = "var(--darkBG)";                
                sliderBar.style.transform = "translateX(0px)";
                sliderBar.style.webkitTransform = "translateX(0px)";
                sliderBar.style.msTransform = "translateX(0px)";    
            } 
            
            else if (size === 3) {
                leftPanel.style.display = "none";
                rightPanel.style.display = "flex";
                rightPanel.style.width = "100%"
                rightPanel.style.backgroundColor = "var(--pageBG)";
                sliderBar.style.transform = "translateX(-15px)";
                sliderBar.style.webkitTransform = "translateX(-15px)";
                sliderBar.style.msTransform = "translateX(-15px)";             
            }
            
            else {
                leftPanel.style.display = "flex";
                leftPanel.style.width = "75%";
                rightPanel.style.display = "flex";
                rightPanel.style.width = "25%";
                rightPanel.style.backgroundColor = "var(--darkBG)";
                sliderBar.style.transform = "translateX(0px)";
                sliderBar.style.webkitTransform = "translateX(0px)";
                sliderBar.style.msTransform = "translateX(0px)";
            }
        }
                
        
        // Add a note manually
        function createManualNote() {
            var noteContent = document.getElementById("manualNote").value;
            addNote(noteContent,0,0,2);
            document.getElementById("manualNote").value = "";
        }
        
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
        var notes = document.getElementById("manualNote");
        var pasteInput = document.getElementById("pasteText");
        var noteEdit = document.getElementById("editText");
        var wpmInput = document.getElementById("wpmInput");
        var isTyping = ((document.activeElement === notes) || (document.activeElement === pasteInput) || (document.activeElement === wpmInput) || (document.activeElement === noteEdit));
        var notesCheck = (document.activeElement === notes);
        var pasteInputCheck = (document.activeElement === pasteInput);
        if (!isTyping) {
        
            if (e.key === 'h') {
                e.preventDefault();
                toggleHighlight();
            } else if (e.key === ' ') {
                e.preventDefault();
                togglePlayPause();
            } else if (e.key === 'v') {
                e.preventDefault();
                noteFocus();                
            } else if (e.key === 'f') {
               e.preventDefault();
                wpm = Math.min(wpm + 10, 2000);
                elements.wpmInput.placeholder = wpm;
                if (isPlaying) {
                currentPos--;
                restartPlayback();
                }
            } else if (e.key === 's'){
                wpm = Math.max(wpm - 10, 50);
                elements.wpmInput.placeholder = wpm;
                if (isPlaying) {
                currentPos--;
                restartPlayback();
                }
            } else if (e.key === "ArrowLeft") {
                e.preventDefault();
                if (currentPos > 15 ){
                    currentPos = (currentPos - 15);
                }
                else { (currentPos=0)}
                if (!isPlaying) {
                        elements.currentWord.textContent = words[currentPos] || 'Ready to start reading...';
                        updateDisplay();
                    }
            } else if (e.key === "ArrowRight") {
                e.preventDefault();
                if (currentPos < (words.length - 15) ){
                    currentPos = (currentPos + 15);
                    }
                if (!isPlaying) {
                     elements.currentWord.textContent = words[currentPos] || 'Ready to start reading...';
                        updateDisplay();
                    }
                }
            }
            else {
                if ((e.key === 'Enter') && (notesCheck)) {
                e.preventDefault();
                createManualNote();
                }
                if ((e.key === 'Enter') && (pasteInputCheck)) {
                e.preventDefault();
                pasteText();
                }
            }
        });
        

        function loadText(text) {
            text = text.trim().replace(/\s+/g, ' ');
            words = text.split(' ').filter(word => word.length > 0);
            currentPos = 0;
            updateDisplay();
            elements.currentWord.textContent = 'Ready to start reading...';
            elements.playPauseButton.disabled = false;
        }
        
        function togglePlayPause() {
            if (words.length === 0) return;
            if (isPlaying) {
                pauseReading();
            } else {
                startReading();
            }
        }


 function startReading() {
    if (words.length === 0) return;
    isPlaying = true;
    elements.playPauseButton.textContent = '||';
    if (playTimeoutId) {
        clearTimeout(playTimeoutId);
        playTimeoutId = null;
    }
    
    scheduleNextWord();
}

function scheduleNextWord() {
    if (!isPlaying) return;
    
    if (currentPos >= words.length) {
        pauseReading();
        return;
    }

endSlice = currentPos+howManyWords;
elements.currentWord.textContent =  words.slice(currentPos, endSlice).join(' ');
const baseDelay = 60000 / wpm; 
        const currentWord = [words.slice(currentPos, endSlice).join(' ')];
        
    let totalDelay = baseDelay;
 if (shouldPauseAfterWord(currentWord)) {
        totalDelay = baseDelay + 150;
    }
currentPos = (currentPos + howManyWords);
    updateDisplay();
    playTimeoutId = setTimeout(scheduleNextWord, totalDelay);
}


function shouldPauseAfterWord(word) {
    if (!word || word.length === 0) return false;
    if (word.length > 10) return true;
    const quotePattern = /\p{P}/gu;
    if (quotePattern.test(word)) {
        return true;
    }
    
    //Might want to add more adjustments for when in multi word mode because it basically always applies the bonus pause
    
    return false;
}
        
        function pauseReading() {
            isPlaying = false;
            elements.playPauseButton.textContent = '>';
            if (playTimeoutId) {
                clearTimeout(playTimeoutId);
                playTimeoutId = null;
            }
        }
        
        function resetReading() {
            pauseReading();
            currentPos = 0;
            elements.currentWord.textContent = 'Ready to start reading...';
            updateDisplay();
        }
        
        function restartPlayback() {
            if (isPlaying) {
                pauseReading();
                startReading();
            }
        }
        
        function toggleHighlight() {
            if (words.length === 0) return;
            
            if (!isHighlighting) {
                startHighlight();
            } else {
                endHighlight();
            }
        }
        
        function startHighlight() {
            isHighlighting = true;
            highlightStart = findSentenceStart(Math.max(0, currentPos - 1));
            elements.highlightIndicator.classList.add('active');
        }
        
        function endHighlight() {
            if (!isHighlighting) return;
            
            isHighlighting = false;
            elements.highlightIndicator.classList.remove('active');
            
            highlightEnd = findSentenceStart(Math.max(0, currentPos - 1));

            if (highlightStart < highlightEnd) {
                const highlightedText = words.slice(highlightStart, highlightEnd).join(' ');
                addNote(highlightedText, highlightStart, highlightEnd, 1);
            }
            if (highlightStart === highlightEnd){
                const highlightedText = words.slice(highlightStart, currentPos).join(' ');
                addNote(highlightedText, highlightStart, currentPos, 1);
            }

        }
        
        function findSentenceStart(index) {
            if (index <= 0) return 0;
            
            for (let i = index - 1; i >= 0; i--) {
                const word = words[i];
                if (word.endsWith('.') || word.endsWith('!') || word.endsWith('?')) {
                    return (Math.min(i+1, words.length-1));
                    }
            }
            return 0;
        }
        
        function addNote(text, start, end, type) {
            //1 is highlight, 2 is manual
            const note = {
                id: Date.now(), 
                text: text,
                timestamp: new Date().toLocaleString(),
                start: start,
                end: end,
                type: type
            };
            if (text.length > 0) {
            notes.push(note);
            updateNotesList(start, end, type);
            }
        }
        
        function deleteNote(noteId) {
            notes = notes.filter(note => note.id !== noteId);
            updateNotesList();
        }
        
        function clearAllNotes() {
            if (notes.length === 0) {
                alert('No notes to clear');
                return;
            }
            
            if (confirm('Are you sure you want to delete all notes?')) {
                notes = [];
                updateNotesList();
            }
        }
        
        function editNote(noteId) {
            const note = findNoteById(noteId);
            if (!note) return;
            
            const noteElement = document.querySelector(`[data-note-id="${noteId}"]`);
            if (!noteElement) return;
            
            const textDiv = noteElement.querySelector('.note-text');
            const originalText = note.text;
            
            textDiv.innerHTML = `<textarea class="edit-textarea" id="editText"; min-height: 60px; resize: vertical; padding: 5px; border: 1px solid var(--accent);">${escapeHtml(originalText)}</textarea>`;
            
            const buttonContainer = noteElement.querySelector('.row.right-align');
            buttonContainer.innerHTML = `
                <button class="button" onclick="saveEditedNote(${noteId})">SAVE</button>
                <button class="button note-delete delete" onclick="cancelEdit(${noteId}, '${escapeHtml(originalText).replace(/'/g, "\\'")}')">BACK</button>
                
            `;
        }
                
         function saveEditedNote(noteId) {
            const note = findNoteById(noteId);
            if (!note) return;
            
            const noteElement = document.querySelector(`[data-note-id="${noteId}"]`);
            const textarea = noteElement.querySelector('.edit-textarea');
            const newText = textarea.value.trim();
            
            if (newText.length === 0) {
                alert('Note cannot be empty');
                return;
            }

            note.text = newText;
            note.timestamp = new Date().toLocaleString();   
            updateNotesList();
        }

        function cancelEdit(noteId, originalText) {
            updateNotesList();
        }

        
        function updateNotesList(start, end, type) {
            if (notes.length === 0) {
                elements.notesList.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Notes go here...</div>';
                return;
            }
            
            elements.notesList.innerHTML = notes.map(note => {
                if (note.type === 1) {
                    return `<div class="note-item1" data-note-id="${note.id}">` +
                        '<div class="note-text">' + escapeHtml(note.text) + '</div>' +
                        '<div class="note-time">' + note.timestamp + '</div>' +
                        '<br>' +
                        '<div class="row right-align">' +
                        '<button class="button" onclick="leftSentence(' + note.id + ')"><<</button>' +
                        '<button class="button" onclick="leftWord(' + note.id + ')"><</button>' +
                        '<button class="button" onclick="rightWord(' + note.id + ')">></button>' +
                        '<button class="button" onclick="rightSentence(' + note.id + ')">>></button>' +
                        '<button class="button note-delete delete" onclick="deleteNote(' + note.id + ')">×</button>' +                    
                        '</div>' +    
                        '</div>';
                } else if (note.type === 2) {
                    return `<div class="note-item2" data-note-id="${note.id}">` +
                        '<div class="note-text">' + escapeHtml(note.text) + '</div>' +
                        '<div class="note-time">' + note.timestamp + '</div>' +
                        '<br>' +
                        '<div class="row right-align">' +
                        '<button class="button" onclick="editNote(' + note.id + ')">EDIT</button>' +
                        '<button class="button note-delete delete" onclick="deleteNote(' + note.id + ')">×</button>' +
                        '</div>' +    
                        '</div>';
                }
            }).join('');
        }


        function findNoteById(noteId) {
            return notes.find(note => note.id === noteId);
        }

        function updateNoteText(noteId, newStart, newEnd) {
            const note = findNoteById(noteId);
            if (!note) return;
            note.start = newStart;
            note.end = newEnd;
            note.text = words.slice(newStart, newEnd + 1).join(' ');
            updateNotesList();
        }

        function leftSentence(noteId) {
            const note = findNoteById(noteId);
            if (!note) return;
            let searchStart = Math.max(0, note.start - 1);
            if (searchStart === note.start) return;
            let newStart = searchStart; 
            for (let i = searchStart - 1; i >= 0; i--) {
                const word = words[i];
                if (isSentenceEnd(word)) {
                    const sentenceStart = Math.max(0, i + 1);
                    if (sentenceStart < note.start) {
                        newStart = sentenceStart;
                    }
                    break;
                }
                if (i === 0) {
                    newStart = 0;
                }
            }
    
    updateNoteText(noteId, newStart, note.end);
}
        function leftWord(noteId) {
            const note = findNoteById(noteId);
            if (!note) return;
            const newStart = Math.max(0, note.start - 1);
            if (newStart !== note.start) {
                updateNoteText(noteId, newStart, note.end);
            }
        }

        function rightWord(noteId) {
            const note = findNoteById(noteId);
            if (!note) return;
            const newEnd = Math.min(words.length - 1, note.end + 1);
            if (newEnd !== note.end) {
                updateNoteText(noteId, note.start, newEnd);
            }
        }

        function rightSentence(noteId) {
            const note = findNoteById(noteId);
            if (!note) return;
            
            let newEnd = note.end;
            if (newEnd >= words.length - 1) return;
            for (let i = newEnd + 1; i < words.length; i++) {
                const word = words[i];
                if (isSentenceEnd(word)) {
                    newEnd = i;
                    break;
                }
                if (i === words.length - 1) {
                    newEnd = words.length - 1;
                }
            }
            
            updateNoteText(noteId, note.start, newEnd);
        }
        
        function isSentenceEnd(word) {
            const cleanWord = word.replace(/["'""'']+$/g, '');
                return cleanWord.endsWith('.') || cleanWord.endsWith('!') || cleanWord.endsWith('?');
            }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function updateColors() {
            const textColor = elements.textColor.value;
            const bgColor = elements.bgColor.value;
            const schemeColor = elements.schemeColor.value;
            const root = document.documentElement; 
            const currentSchemeAccent = getComputedStyle(root).getPropertyValue('--accent')
            const currentSchemelightBG = getComputedStyle(root).getPropertyValue('--lightBG')
            const currentSchemedarkBG = getComputedStyle(root).getPropertyValue('--darkBG')
            
            elements.textDisplay.style.setProperty('--chooseTC', textColor);
            elements.textDisplay.style.setProperty('--chooseBG', bgColor);
            root.style.setProperty('--accent', schemeColor);
            var newLight = ColorLuminance(schemeColor,-0.7);
            var newDark = ColorLuminance(schemeColor,-0.9);
            root.style.setProperty('--lightBG', newLight);
            root.style.setProperty('--darkBG', newDark);
        }
        
        //add matching color scheme https://www.sitepoint.com/javascript-generate-lighter-darker-color/
        function ColorLuminance(hex, lum) {
        	hex = String(hex).replace(/[^0-9a-f]/gi, '');
        	if (hex.length < 6) {
        		hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
        	}
        	lum = lum || 0;
        
        	// convert to decimal and change luminosity
        	var rgb = "#", c, i;
        	for (i = 0; i < 3; i++) {
        		c = parseInt(hex.substr(i*2,2), 16);
        		c = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);
        		rgb += ("00"+c).substr(c.length);
        	}
        
        	return rgb;
        }
        
        async function updateDisplay() {
            const progress = words.length > 0 ? (currentPos / words.length) * 100 : 0;
            elements.progressFill.style.width = progress + '%';
            elements.positionInfo.textContent = currentPos + ' / ' + words.length;
            
            if (words.length > 0) {
                const wordsRemaining = words.length - currentPos;
                const timeRemaining = (wordsRemaining / wpm) * 60; // seconds
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = Math.floor(timeRemaining % 60);
                elements.timeInfo.textContent = minutes + ':' + seconds.toString().padStart(2, '0');
            } else {
                elements.timeInfo.textContent = '--:--';
            }
        }
        
        
        function saveNotes() {
            if (notes.length === 0) {
                alert('No notes to save');
                return;
            }
            
            const notesText = notes.map(note => 
                note.text + '\n' +
                '\n'
            ).join('\n');
            
            let fileName = 'rsvp-notes';
            if (currentFileName) {
                fileName = currentFileName + '-notes';
            }
            fileName += '.md';
            
            const blob = new Blob([notesText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Initialize
        updateDisplay();
        updateColors();
    </script>

</body></html>
        </section>
        <div class="post-tags">
          
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2025  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>

</div>
    </body>
</html>
